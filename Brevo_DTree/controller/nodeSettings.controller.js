sap.ui.define(["sap/ui/core/mvc/Controller"],function(e){"use strict";return e.extend("Brevo.BrevoDtree.controller.nodeSettings",{onInit:function(){var e=this;var t=sap.ui.getCore().getEventBus();t.subscribe("treeData","settings",function(t,s,i){e.treeData=i;e.getView().byId("scenEntity").setText(i.scenario.Entity);e.getView().byId("Scentitle").setText(i.scenario.scenarioTitle);e.getView().byId("datamodel").setText(i.scenario.serviceURL);if(i.node.dtitle!=i.scenario.Entity){var a=[{name:"External Assumptions",key:"Assumptions"},{name:"Formula",key:"Formula"},{name:"System Derived",key:"SystemDerived"}];e.getView().byId("systemFormulaText").setText(i.node.value_org+"-("+i.node.co_val+"*"+i.node.value+")");e.getView().byId("systemValue").setValue(i.node.co_val)}else{var a=[{name:"External Assumptions",key:"Assumptions"},{name:"Formula",key:"Formula"}]}var l=new sap.ui.model.json.JSONModel(a);e.getView().byId("calculateKey").setModel(l);e.getView().byId("calculateKey").setSelectedKey("Assumptions");var o=[];if(i.scenario.measures.length>0){for(var n=0;n<i.scenario.measures.length;n++){o.push(i.scenario.measures[n])}}var r=[];if(i.scenario.dimension.length>0){for(var n=0;n<i.scenario.dimension.length;n++){r.push(i.scenario.dimension[n])}}e.getView().byId("scenDim").setText(r);e.getView().byId("scenMeas").setText(o);e.getView().byId("nodeName").setText(i.node.name);e.getView().byId("extLabelValue").setValue(i.node.value);var u=[];var d=i.scenario.measures;for(var V=0;V<d.length;V++){var i={key:d[V].Value,label:d[V].Value,items:[{key:d[V].Value},{key:"+"},{key:d[V].Value}]};u.push(i)}var y=new sap.ui.model.json.JSONModel(u);e.getView().byId("formulaValue").setModel(y);e.handleSelectionChange("Assumptions")})},navBackToTreeView:function(){this.resetField();window.history.go(-1)},handleSelectionChange:function(e){if(e=="Assumptions")this.setCalculationDetails("Assumptions");else this.setCalculationDetails(e.oSource.getSelectedKey())},setCalculationDetails:function(e){var t=this;if(e=="Assumptions"){this.getView().byId("extLabelText").setVisible(true);this.getView().byId("extLabelValue").setVisible(true);this.getView().byId("formulaText").setVisible(false);this.getView().byId("formulaValue").setVisible(false);this.getView().byId("coefficientLabel").setVisible(false);this.getView().byId("systemValue").setVisible(false);this.getView().byId("systemFormula").setVisible(false);this.getView().byId("systemFormulaText").setVisible(false);this.getView().byId("systemFormulaLabel").setVisible(false)}else if(e=="Formula"){this.getView().byId("extLabelText").setVisible(false);this.getView().byId("extLabelValue").setVisible(false);this.getView().byId("formulaText").setVisible(true);this.getView().byId("formulaValue").setVisible(true);this.getView().byId("coefficientLabel").setVisible(false);this.getView().byId("systemValue").setVisible(false);this.getView().byId("systemFormulaText").setVisible(false);this.getView().byId("systemFormula").setVisible(false);this.getView().byId("systemFormulaLabel").setVisible(false)}else{this.getView().byId("extLabelText").setVisible(false);this.getView().byId("extLabelValue").setVisible(false);this.getView().byId("formulaText").setVisible(false);this.getView().byId("formulaValue").setVisible(false);this.getView().byId("coefficientLabel").setVisible(true);this.getView().byId("systemValue").setVisible(true);this.getView().byId("systemFormula").setVisible(true);this.getView().byId("systemFormulaText").setVisible(true);this.getView().byId("systemFormulaLabel").setVisible(true);if(t.treeData.node.System_co_val)t.getView().byId("resetButtonId").setVisible(true);else t.getView().byId("resetButtonId").setVisible(false)}},onNodeCancel:function(){this.resetField();window.history.go(-1)},onNodeSave:function(){var e=this;var t,s,i;var a=e.getView().byId("calculateKey").getSelectedKey();var l=e.getView().byId("nodeName").getText();var o=e.treeData.variant.VariantId.toString();if(a!="SystemDerived"){if(a=="Assumptions"){s="External Assumptions";i=e.getView().byId("extLabelValue").getValue()}else if(a=="Formula"){s="Formula";i=e.getView().byId("formulaValue").getExpression()}if(i.length!=0){var n=e.treeData.node;var r=JSON.parse(e.treeData.variant.MeasureTree);if(n.name==r.name){}else{r.children.forEach(function(t){if(n.name==t.name){n.value_copy=n.value;n.value=parseInt(e.getView().byId("extLabelValue").getValue());e.treeData.variant.MeasureTree=JSON.stringify(r);e.onUpdateSystemData(n,a)}})}}else{sap.m.MessageToast.show("Value field is Required")}}else{i=e.getView().byId("systemValue").getValue();if(e.treeData.node.System_co_val){e.onUpdateSystemData(e.treeData.node,a)}else{e.onUpdateSystemData(e.treeData.node,"Assumptions")}}},onSystemCoEfficientChange:function(){var e=this;var t=e.getView().byId("systemValue").getValue();e.getView().byId("resetButtonId").setVisible(true);var s=e.treeData.node;if(s.System_co_val){s.co_val=Number(t)}else{s.System_co_val=s.co_val;s.co_val=Number(t)}},onResetButtonPress:function(){var e=this;var t=e.treeData.node;t.co_val=t.System_co_val;e.getView().byId("systemValue").setValue(e.treeData.node.co_val);delete t.System_co_val;e.getView().byId("resetButtonId").setVisible(false)},onPostData:function(e,t,s){var i=this;sap.m.MessageToast.show("Node setting saved");i.resetField();var a=sap.ui.core.UIComponent.getRouterFor(i);a.navTo("treeView");var l=sap.ui.getCore().getEventBus();l.publish("systemsetting","systemtreeData",{nodedetails:t,key:s})},onUpdateSystemData:function(e,t){sap.m.MessageToast.show("Node setting saved");this.resetField();var s=sap.ui.core.UIComponent.getRouterFor(this);s.navTo("treeView");var i=sap.ui.getCore().getEventBus();i.publish("systemsetting","systemtreeData",{nodedetails:e,key:t})},resetField:function(){this.getView().byId("extLabelValue").setValue();this.getView().byId("formulaValue").setExpression(" ");this.getView().byId("systemValue").setValue();this.getView().byId("systemFormulaText").setText();this.getView().byId("resetButtonId").setVisible(false)}})});