/**
 * gridstack.js 0.2.7-dev
 * http://troolee.github.io/gridstack.js/
 * (c) 2014-2016 Pavel Reznikov, Dylan Weiss
 * gridstack.js may be freely distributed under the MIT license.
 * @preserve
 */
(function(t){if(typeof define==="function"&&define.amd){define(["jquery","lodash"],t)}else if(typeof exports!=="undefined"){try{jQuery=require("jquery")}catch(t){}try{_=require("lodash")}catch(t){}t(jQuery,_)}else{t(jQuery,_)}})(function(t,e){var i=window;var a=function(t,e,i){var a=function(){console.warn("gridstack.js: Function `"+e+"` is deprecated as of v0.2.5 and has been replaced "+"with `"+i+"`. It will be **completely** removed in v1.0.");return t.apply(this,arguments)};a.prototype=t.prototype;return a};var o=function(t,e){console.warn("gridstack.js: Option `"+t+"` is deprecated as of v0.2.5 and has been replaced with `"+e+"`. It will be **completely** removed in v1.0.")};var r={isIntercepted:function(t,e){return!(t.x+t.width<=e.x||e.x+e.width<=t.x||t.y+t.height<=e.y||e.y+e.height<=t.y)},sort:function(t,i,a){a=a||e.chain(t).map(function(t){return t.x+t.width}).max().value();i=i!=-1?1:-1;return e.sortBy(t,function(t){return i*(t.x+t.y*a)})},createStylesheet:function(t){var e=document.createElement("style");e.setAttribute("type","text/css");e.setAttribute("data-gs-style-id",t);if(e.styleSheet){e.styleSheet.cssText=""}else{e.appendChild(document.createTextNode(""))}document.getElementsByTagName("head")[0].appendChild(e);return e.sheet},removeStylesheet:function(e){t("STYLE[data-gs-style-id="+e+"]").remove()},insertCSSRule:function(t,e,i,a){if(typeof t.insertRule==="function"){t.insertRule(e+"{"+i+"}",a)}else if(typeof t.addRule==="function"){t.addRule(e,i,a)}},toBool:function(t){if(typeof t=="boolean"){return t}if(typeof t=="string"){t=t.toLowerCase();return!(t===""||t=="no"||t=="false"||t=="0")}return Boolean(t)},_collisionNodeCheck:function(t){return t!=this.node&&r.isIntercepted(t,this.nn)},_didCollide:function(t){return r.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},t)},_isAddNodeIntercepted:function(t){return r.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},t)},parseHeight:function(t){var i=t;var a="px";if(i&&e.isString(i)){var o=i.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw)?$/);if(!o){throw new Error("Invalid height")}a=o[2]||"px";i=parseFloat(o[1])}return{height:i,unit:a}}};r.is_intercepted=a(r.isIntercepted,"is_intercepted","isIntercepted");r.create_stylesheet=a(r.createStylesheet,"create_stylesheet","createStylesheet");r.remove_stylesheet=a(r.removeStylesheet,"remove_stylesheet","removeStylesheet");r.insert_css_rule=a(r.insertCSSRule,"insert_css_rule","insertCSSRule");function n(t){this.grid=t}n.registeredPlugins=[];n.registerPlugin=function(t){n.registeredPlugins.push(t)};n.prototype.resizable=function(t,e){return this};n.prototype.draggable=function(t,e){return this};n.prototype.droppable=function(t,e){return this};n.prototype.isDroppable=function(t){return false};n.prototype.on=function(t,e,i){return this};var s=0;var d=function(t,e,i,a,o){this.width=t;this.float=i||false;this.height=a||0;this.nodes=o||[];this.onchange=e||function(){};this._updateCounter=0;this._float=this.float;this._addedNodes=[];this._removedNodes=[]};d.prototype.batchUpdate=function(){this._updateCounter=1;this.float=true};d.prototype.commit=function(){if(this._updateCounter!==0){this._updateCounter=0;this.float=this._float;this._packNodes();this._notify()}};d.prototype.getNodeDataByDOMEl=function(t){return e.find(this.nodes,function(e){return t.get(0)===e.el.get(0)})};d.prototype._fixCollisions=function(t){var i=this;this._sortNodes(-1);var a=t;var o=Boolean(e.find(this.nodes,function(t){return t.locked}));if(!this.float&&!o){a={x:0,y:t.y,width:this.width,height:t.height}}while(true){var n=e.find(this.nodes,e.bind(r._collisionNodeCheck,{node:t,nn:a}));if(typeof n=="undefined"){return}this.moveNode(n,n.x,t.y+t.height,n.width,n.height,true)}};d.prototype.isAreaEmpty=function(t,i,a,o){var n={x:t||0,y:i||0,width:a||1,height:o||1};var s=e.find(this.nodes,e.bind(function(t){return r.isIntercepted(t,n)},this));return s===null||typeof s==="undefined"};d.prototype._sortNodes=function(t){this.nodes=r.sort(this.nodes,t,this.width)};d.prototype._packNodes=function(){this._sortNodes();if(this.float){e.each(this.nodes,e.bind(function(t,i){if(t._updating||typeof t._origY=="undefined"||t.y==t._origY){return}var a=t.y;while(a>=t._origY){var o=e.chain(this.nodes).find(e.bind(r._didCollide,{n:t,newY:a})).value();if(!o){t._dirty=true;t.y=a}--a}},this))}else{e.each(this.nodes,e.bind(function(t,i){if(t.locked){return}while(t.y>0){var a=t.y-1;var o=i===0;if(i>0){var n=e.chain(this.nodes).take(i).find(e.bind(r._didCollide,{n:t,newY:a})).value();o=typeof n=="undefined"}if(!o){break}t._dirty=t.y!=a;t.y=a}},this))}};d.prototype._prepareNode=function(t,i){t=e.defaults(t||{},{width:1,height:1,x:0,y:0});t.x=parseInt(""+t.x);t.y=parseInt(""+t.y);t.width=parseInt(""+t.width);t.height=parseInt(""+t.height);t.autoPosition=t.autoPosition||false;t.noResize=t.noResize||false;t.noMove=t.noMove||false;if(t.width>this.width){t.width=this.width}else if(t.width<1){t.width=1}if(t.height<1){t.height=1}if(t.x<0){t.x=0}if(t.x+t.width>this.width){if(i){t.width=this.width-t.x}else{t.x=this.width-t.width}}if(t.y<0){t.y=0}return t};d.prototype._notify=function(){var t=Array.prototype.slice.call(arguments,0);t[0]=typeof t[0]==="undefined"?[]:[t[0]];t[1]=typeof t[1]==="undefined"?true:t[1];if(this._updateCounter){return}var e=t[0].concat(this.getDirtyNodes());this.onchange(e,t[1])};d.prototype.cleanNodes=function(){if(this._updateCounter){return}e.each(this.nodes,function(t){t._dirty=false})};d.prototype.getDirtyNodes=function(){return e.filter(this.nodes,function(t){return t._dirty})};d.prototype.addNode=function(t,i){t=this._prepareNode(t);if(typeof t.maxWidth!="undefined"){t.width=Math.min(t.width,t.maxWidth)}if(typeof t.maxHeight!="undefined"){t.height=Math.min(t.height,t.maxHeight)}if(typeof t.minWidth!="undefined"){t.width=Math.max(t.width,t.minWidth)}if(typeof t.minHeight!="undefined"){t.height=Math.max(t.height,t.minHeight)}t._id=++s;t._dirty=true;if(t.autoPosition){this._sortNodes();for(var a=0;;++a){var o=a%this.width;var n=Math.floor(a/this.width);if(o+t.width>this.width){continue}if(!e.find(this.nodes,e.bind(r._isAddNodeIntercepted,{x:o,y:n,node:t}))){t.x=o;t.y=n;break}}}this.nodes.push(t);if(typeof i!="undefined"&&i){this._addedNodes.push(e.clone(t))}this._fixCollisions(t);this._packNodes();this._notify();return t};d.prototype.removeNode=function(t,i){i=typeof i==="undefined"?true:i;this._removedNodes.push(e.clone(t));t._id=null;this.nodes=e.without(this.nodes,t);this._packNodes();this._notify(t,i)};d.prototype.canMoveNode=function(i,a,o,r,n){if(!this.isNodeChangedPosition(i,a,o,r,n)){return false}var s=Boolean(e.find(this.nodes,function(t){return t.locked}));if(!this.height&&!s){return true}var h;var l=new d(this.width,null,this.float,0,e.map(this.nodes,function(e){if(e==i){h=t.extend({},e);return h}return t.extend({},e)}));if(typeof h==="undefined"){return true}l.moveNode(h,a,o,r,n);var p=true;if(s){p&=!Boolean(e.find(l.nodes,function(t){return t!=h&&Boolean(t.locked)&&Boolean(t._dirty)}))}if(this.height){p&=l.getGridHeight()<=this.height}return p};d.prototype.canBePlacedWithRespectToHeight=function(i){if(!this.height){return true}var a=new d(this.width,null,this.float,0,e.map(this.nodes,function(e){return t.extend({},e)}));a.addNode(i);return a.getGridHeight()<=this.height};d.prototype.isNodeChangedPosition=function(t,e,i,a,o){if(typeof e!="number"){e=t.x}if(typeof i!="number"){i=t.y}if(typeof a!="number"){a=t.width}if(typeof o!="number"){o=t.height}if(typeof t.maxWidth!="undefined"){a=Math.min(a,t.maxWidth)}if(typeof t.maxHeight!="undefined"){o=Math.min(o,t.maxHeight)}if(typeof t.minWidth!="undefined"){a=Math.max(a,t.minWidth)}if(typeof t.minHeight!="undefined"){o=Math.max(o,t.minHeight)}if(t.x==e&&t.y==i&&t.width==a&&t.height==o){return false}return true};d.prototype.moveNode=function(t,e,i,a,o,r){if(!this.isNodeChangedPosition(t,e,i,a,o)){return t}if(typeof e!="number"){e=t.x}if(typeof i!="number"){i=t.y}if(typeof a!="number"){a=t.width}if(typeof o!="number"){o=t.height}if(typeof t.maxWidth!="undefined"){a=Math.min(a,t.maxWidth)}if(typeof t.maxHeight!="undefined"){o=Math.min(o,t.maxHeight)}if(typeof t.minWidth!="undefined"){a=Math.max(a,t.minWidth)}if(typeof t.minHeight!="undefined"){o=Math.max(o,t.minHeight)}if(t.x==e&&t.y==i&&t.width==a&&t.height==o){return t}var n=t.width!=a;t._dirty=true;t.x=e;t.y=i;t.width=a;t.height=o;t=this._prepareNode(t,n);this._fixCollisions(t);if(!r){this._packNodes();this._notify()}return t};d.prototype.getGridHeight=function(){return e.reduce(this.nodes,function(t,e){return Math.max(t,e.y+e.height)},0)};d.prototype.beginUpdate=function(t){e.each(this.nodes,function(t){t._origY=t.y});t._updating=true};d.prototype.endUpdate=function(){e.each(this.nodes,function(t){t._origY=t.y});var t=e.find(this.nodes,function(t){return t._updating});if(t){t._updating=false}};var h=function(i,a){var r=this;var s,h;a=a||{};this.container=t(i);if(typeof a.handle_class!=="undefined"){a.handleClass=a.handle_class;o("handle_class","handleClass")}if(typeof a.item_class!=="undefined"){a.itemClass=a.item_class;o("item_class","itemClass")}if(typeof a.placeholder_class!=="undefined"){a.placeholderClass=a.placeholder_class;o("placeholder_class","placeholderClass")}if(typeof a.placeholder_text!=="undefined"){a.placeholderText=a.placeholder_text;o("placeholder_text","placeholderText")}if(typeof a.cell_height!=="undefined"){a.cellHeight=a.cell_height;o("cell_height","cellHeight")}if(typeof a.vertical_margin!=="undefined"){a.verticalMargin=a.vertical_margin;o("vertical_margin","verticalMargin")}if(typeof a.min_width!=="undefined"){a.minWidth=a.min_width;o("min_width","minWidth")}if(typeof a.static_grid!=="undefined"){a.staticGrid=a.static_grid;o("static_grid","staticGrid")}if(typeof a.is_nested!=="undefined"){a.isNested=a.is_nested;o("is_nested","isNested")}if(typeof a.always_show_resize_handle!=="undefined"){a.alwaysShowResizeHandle=a.always_show_resize_handle;o("always_show_resize_handle","alwaysShowResizeHandle")}a.itemClass=a.itemClass||"grid-stack-item";var l=this.container.closest("."+a.itemClass).length>0;this.opts=e.defaults(a||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:60,verticalMargin:20,auto:true,minWidth:768,float:false,staticGrid:false,_class:"grid-stack-instance-"+(Math.random()*1e4).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||false,alwaysShowResizeHandle:a.alwaysShowResizeHandle||false,resizable:e.defaults(a.resizable||{},{autoHide:!(a.alwaysShowResizeHandle||false),handles:"se"}),draggable:e.defaults(a.draggable||{},{handle:(a.handleClass?"."+a.handleClass:a.handle?a.handle:"")||".grid-stack-item-content",scroll:false,appendTo:"body"}),disableDrag:a.disableDrag||false,disableResize:a.disableResize||false,rtl:"auto",removable:false,removeTimeout:2e3,verticalMarginUnit:"px",cellHeightUnit:"px",oneColumnModeClass:a.oneColumnModeClass||"grid-stack-one-column-mode",ddPlugin:null});if(this.opts.ddPlugin===false){this.opts.ddPlugin=n}else if(this.opts.ddPlugin===null){this.opts.ddPlugin=e.first(n.registeredPlugins)||n}this.dd=new this.opts.ddPlugin(this);if(this.opts.rtl==="auto"){this.opts.rtl=this.container.css("direction")==="rtl"}if(this.opts.rtl){this.container.addClass("grid-stack-rtl")}this.opts.isNested=l;h=this.opts.cellHeight==="auto";if(h){r.cellHeight(r.cellWidth(),true)}else{this.cellHeight(this.opts.cellHeight,true)}this.verticalMargin(this.opts.verticalMargin,true);this.container.addClass(this.opts._class);this._setStaticClass();if(l){this.container.addClass("grid-stack-nested")}this._initStyles();this.grid=new d(this.opts.width,function(t,i){i=typeof i==="undefined"?true:i;var a=0;e.each(t,function(t){if(i&&t._id===null){if(t.el){t.el.remove()}}else{t.el.attr("data-gs-x",t.x).attr("data-gs-y",t.y).attr("data-gs-width",t.width).attr("data-gs-height",t.height);a=Math.max(a,t.y+t.height)}});r._updateStyles(a+10)},this.opts.float,this.opts.height);if(this.opts.auto){var p=[];var g=this;this.container.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each(function(e,i){i=t(i);p.push({el:i,i:parseInt(i.attr("data-gs-x"))+parseInt(i.attr("data-gs-y"))*g.opts.width})});e.chain(p).sortBy(function(t){return t.i}).each(function(t){r._prepareElement(t.el)}).value()}this.setAnimation(this.opts.animate);this.placeholder=t('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'">'+'<div class="placeholder-content">'+this.opts.placeholderText+"</div></div>").hide();this._updateContainerHeight();this._updateHeightsOnResize=e.throttle(function(){r.cellHeight(r.cellWidth(),false)},100);this.onResizeHandler=function(){if(h){r._updateHeightsOnResize()}if(r._isOneColumnMode()){if(s){return}r.container.addClass(r.opts.oneColumnModeClass);s=true;r.grid._sortNodes();e.each(r.grid.nodes,function(t){r.container.append(t.el);if(r.opts.staticGrid){return}if(t.noMove||r.opts.disableDrag){r.dd.draggable(t.el,"disable")}if(t.noResize||r.opts.disableResize){r.dd.resizable(t.el,"disable")}t.el.trigger("resize")})}else{if(!s){return}r.container.removeClass(r.opts.oneColumnModeClass);s=false;if(r.opts.staticGrid){return}e.each(r.grid.nodes,function(t){if(!t.noMove&&!r.opts.disableDrag){r.dd.draggable(t.el,"enable")}if(!t.noResize&&!r.opts.disableResize){r.dd.resizable(t.el,"enable")}t.el.trigger("resize")})}};t(window).resize(this.onResizeHandler);this.onResizeHandler();if(!r.opts.staticGrid&&typeof r.opts.removable==="string"){var c=t(r.opts.removable);if(!this.dd.isDroppable(c)){this.dd.droppable(c,{accept:"."+r.opts.itemClass})}this.dd.on(c,"dropover",function(e,i){var a=t(i.draggable);var o=a.data("_gridstack_node");if(o._grid!==r){return}r._setupRemovingTimeout(a)}).on(c,"dropout",function(e,i){var a=t(i.draggable);var o=a.data("_gridstack_node");if(o._grid!==r){return}r._clearRemovingTimeout(a)})}if(!r.opts.staticGrid&&r.opts.acceptWidgets){var u=null;var f=function(t,e){var i=u;var a=i.data("_gridstack_node");var o=r.getCellFromPixel(e.offset,true);var n=Math.max(0,o.x);var s=Math.max(0,o.y);if(!a._added){a._added=true;a.el=i;a.x=n;a.y=s;r.grid.cleanNodes();r.grid.beginUpdate(a);r.grid.addNode(a);r.container.append(r.placeholder);r.placeholder.attr("data-gs-x",a.x).attr("data-gs-y",a.y).attr("data-gs-width",a.width).attr("data-gs-height",a.height).show();a.el=r.placeholder;a._beforeDragX=a.x;a._beforeDragY=a.y;r._updateContainerHeight()}else{if(!r.grid.canMoveNode(a,n,s)){return}r.grid.moveNode(a,n,s);r._updateContainerHeight()}};this.dd.droppable(r.container,{accept:function(e){e=t(e);var i=e.data("_gridstack_node");if(i&&i._grid===r){return false}return e.is(r.opts.acceptWidgets===true?".grid-stack-item":r.opts.acceptWidgets)}}).on(r.container,"dropover",function(e,i){var a=r.container.offset();var o=t(i.draggable);var n=r.cellWidth();var s=r.cellHeight();var d=o.data("_gridstack_node");var h=d?d.width:Math.ceil(o.outerWidth()/n);var l=d?d.height:Math.ceil(o.outerHeight()/s);u=o;var p=r.grid._prepareNode({width:h,height:l,_added:false,_temporary:true});o.data("_gridstack_node",p);o.data("_gridstack_node_orig",d);o.on("drag",f)}).on(r.container,"dropout",function(e,i){var a=t(i.draggable);a.unbind("drag",f);var o=a.data("_gridstack_node");o.el=null;r.grid.removeNode(o);r.placeholder.detach();r._updateContainerHeight();a.data("_gridstack_node",a.data("_gridstack_node_orig"))}).on(r.container,"drop",function(e,i){r.placeholder.detach();var a=t(i.draggable).data("_gridstack_node");a._grid=r;var o=t(i.draggable).clone(false);o.data("_gridstack_node",a);t(i.draggable).remove();a.el=o;r.placeholder.hide();o.attr("data-gs-x",a.x).attr("data-gs-y",a.y).attr("data-gs-width",a.width).attr("data-gs-height",a.height).addClass(r.opts.itemClass).removeAttr("style").enableSelection().removeData("draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled").unbind("drag",f);r.container.append(o);r._prepareElementsByNode(o,a);r._updateContainerHeight();r._triggerChangeEvent();r.grid.endUpdate()})}};h.prototype._triggerChangeEvent=function(t){var e=this.grid.getDirtyNodes();var i=false;var a=[];if(e&&e.length){a.push(e);i=true}if(i||t===true){this.container.trigger("change",a)}};h.prototype._triggerAddEvent=function(){if(this.grid._addedNodes&&this.grid._addedNodes.length>0){this.container.trigger("added",[e.map(this.grid._addedNodes,e.clone)]);this.grid._addedNodes=[]}};h.prototype._triggerRemoveEvent=function(){if(this.grid._removedNodes&&this.grid._removedNodes.length>0){this.container.trigger("removed",[e.map(this.grid._removedNodes,e.clone)]);this.grid._removedNodes=[]}};h.prototype._initStyles=function(){if(this._stylesId){r.removeStylesheet(this._stylesId)}this._stylesId="gridstack-style-"+(Math.random()*1e5).toFixed();this._styles=r.createStylesheet(this._stylesId);if(this._styles!==null){this._styles._max=0}};h.prototype._updateStyles=function(t){if(this._styles===null||typeof this._styles==="undefined"){return}var e="."+this.opts._class+" ."+this.opts.itemClass;var i=this;var a;if(typeof t=="undefined"){t=this._styles._max;this._initStyles();this._updateContainerHeight()}if(!this.opts.cellHeight){return}if(this._styles._max!==0&&t<=this._styles._max){return}if(!this.opts.verticalMargin||this.opts.cellHeightUnit===this.opts.verticalMarginUnit){a=function(t,e){return i.opts.cellHeight*t+i.opts.verticalMargin*e+i.opts.cellHeightUnit}}else{a=function(t,e){if(!t||!e){return i.opts.cellHeight*t+i.opts.verticalMargin*e+i.opts.cellHeightUnit}return"calc("+(i.opts.cellHeight*t+i.opts.cellHeightUnit)+" + "+(i.opts.verticalMargin*e+i.opts.verticalMarginUnit)+")"}}if(this._styles._max===0){r.insertCSSRule(this._styles,e,"min-height: "+a(1,0)+";",0)}if(t>this._styles._max){for(var o=this._styles._max;o<t;++o){r.insertCSSRule(this._styles,e+'[data-gs-height="'+(o+1)+'"]',"height: "+a(o+1,o)+";",o);r.insertCSSRule(this._styles,e+'[data-gs-min-height="'+(o+1)+'"]',"min-height: "+a(o+1,o)+";",o);r.insertCSSRule(this._styles,e+'[data-gs-max-height="'+(o+1)+'"]',"max-height: "+a(o+1,o)+";",o);r.insertCSSRule(this._styles,e+'[data-gs-y="'+o+'"]',"top: "+a(o,o)+";",o)}this._styles._max=t}};h.prototype._updateContainerHeight=function(){if(this.grid._updateCounter){return}var t=this.grid.getGridHeight();this.container.attr("data-gs-current-height",t);if(!this.opts.cellHeight){return}if(!this.opts.verticalMargin){this.container.css("height",t*this.opts.cellHeight+this.opts.cellHeightUnit)}else if(this.opts.cellHeightUnit===this.opts.verticalMarginUnit){this.container.css("height",t*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit)}else{this.container.css("height","calc("+(t*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(t*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")")}};h.prototype._isOneColumnMode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.minWidth};h.prototype._setupRemovingTimeout=function(e){var i=this;var a=t(e).data("_gridstack_node");if(a._removeTimeout||!i.opts.removable){return}a._removeTimeout=setTimeout(function(){e.addClass("grid-stack-item-removing");a._isAboutToRemove=true},i.opts.removeTimeout)};h.prototype._clearRemovingTimeout=function(e){var i=t(e).data("_gridstack_node");if(!i._removeTimeout){return}clearTimeout(i._removeTimeout);i._removeTimeout=null;e.removeClass("grid-stack-item-removing");i._isAboutToRemove=false};h.prototype._prepareElementsByNode=function(e,i){if(typeof t.ui==="undefined"){return}var a=this;var o;var r;var n=function(t,n){var s=Math.round(n.position.left/o);var d=Math.floor((n.position.top+r/2)/r);var h;var l;if(t.type!="drag"){h=Math.round(n.size.width/o);l=Math.round(n.size.height/r)}if(t.type=="drag"){if(s<0||s>=a.grid.width||d<0){if(a.opts.removable===true){a._setupRemovingTimeout(e)}s=i._beforeDragX;d=i._beforeDragY;a.placeholder.detach();a.placeholder.hide();a.grid.removeNode(i);a._updateContainerHeight();i._temporaryRemoved=true}else{a._clearRemovingTimeout(e);if(i._temporaryRemoved){a.grid.addNode(i);a.placeholder.attr("data-gs-x",s).attr("data-gs-y",d).attr("data-gs-width",h).attr("data-gs-height",l).show();a.container.append(a.placeholder);i.el=a.placeholder;i._temporaryRemoved=false}}}else if(t.type=="resize"){if(s<0){return}}if(!a.grid.canMoveNode(i,s,d,h,l)){return}a.grid.moveNode(i,s,d,h,l);a._updateContainerHeight()};var s=function(n,s){a.container.append(a.placeholder);var d=t(this);a.grid.cleanNodes();a.grid.beginUpdate(i);o=a.cellWidth();var h=Math.ceil(d.outerHeight()/d.attr("data-gs-height"));r=a.container.height()/parseInt(a.container.attr("data-gs-current-height"));a.placeholder.attr("data-gs-x",d.attr("data-gs-x")).attr("data-gs-y",d.attr("data-gs-y")).attr("data-gs-width",d.attr("data-gs-width")).attr("data-gs-height",d.attr("data-gs-height")).show();i.el=a.placeholder;i._beforeDragX=i.x;i._beforeDragY=i.y;a.dd.resizable(e,"option","minWidth",o*(i.minWidth||1));a.dd.resizable(e,"option","minHeight",h*(i.minHeight||1));if(n.type=="resizestart"){d.find(".grid-stack-item").trigger("resizestart")}};var d=function(o,r){var n=t(this);if(!n.data("_gridstack_node")){return}var s=false;a.placeholder.detach();i.el=n;a.placeholder.hide();if(i._isAboutToRemove){s=true;e.removeData("_gridstack_node");e.remove()}else{a._clearRemovingTimeout(e);if(!i._temporaryRemoved){n.attr("data-gs-x",i.x).attr("data-gs-y",i.y).attr("data-gs-width",i.width).attr("data-gs-height",i.height).removeAttr("style")}else{n.attr("data-gs-x",i._beforeDragX).attr("data-gs-y",i._beforeDragY).attr("data-gs-width",i.width).attr("data-gs-height",i.height).removeAttr("style");i.x=i._beforeDragX;i.y=i._beforeDragY;a.grid.addNode(i)}}a._updateContainerHeight();a._triggerChangeEvent(s);a.grid.endUpdate();var d=n.find(".grid-stack");if(d.length&&o.type=="resizestop"){d.each(function(e,i){t(i).data("gridstack").onResizeHandler()});n.find(".grid-stack-item").trigger("resizestop")}};this.dd.draggable(e,{start:s,stop:d,drag:n}).resizable(e,{start:s,stop:d,resize:n});if(i.noMove||this._isOneColumnMode()||this.opts.disableDrag){this.dd.draggable(e,"disable")}if(i.noResize||this._isOneColumnMode()||this.opts.disableResize){this.dd.resizable(e,"disable")}e.attr("data-gs-locked",i.locked?"yes":null)};h.prototype._prepareElement=function(e,i){i=typeof i!="undefined"?i:false;var a=this;e=t(e);e.addClass(this.opts.itemClass);var o=a.grid.addNode({x:e.attr("data-gs-x"),y:e.attr("data-gs-y"),width:e.attr("data-gs-width"),height:e.attr("data-gs-height"),maxWidth:e.attr("data-gs-max-width"),minWidth:e.attr("data-gs-min-width"),maxHeight:e.attr("data-gs-max-height"),minHeight:e.attr("data-gs-min-height"),autoPosition:r.toBool(e.attr("data-gs-auto-position")),noResize:r.toBool(e.attr("data-gs-no-resize")),noMove:r.toBool(e.attr("data-gs-no-move")),locked:r.toBool(e.attr("data-gs-locked")),el:e,id:e.attr("data-gs-id"),_grid:a},i);e.data("_gridstack_node",o);this._prepareElementsByNode(e,o)};h.prototype.setAnimation=function(t){if(t){this.container.addClass("grid-stack-animate")}else{this.container.removeClass("grid-stack-animate")}};h.prototype.addWidget=function(e,i,a,o,r,n,s,d,h,l,p){e=t(e);if(typeof i!="undefined"){e.attr("data-gs-x",i)}if(typeof a!="undefined"){e.attr("data-gs-y",a)}if(typeof o!="undefined"){e.attr("data-gs-width",o)}if(typeof r!="undefined"){e.attr("data-gs-height",r)}if(typeof n!="undefined"){e.attr("data-gs-auto-position",n?"yes":null)}if(typeof s!="undefined"){e.attr("data-gs-min-width",s)}if(typeof d!="undefined"){e.attr("data-gs-max-width",d)}if(typeof h!="undefined"){e.attr("data-gs-min-height",h)}if(typeof l!="undefined"){e.attr("data-gs-max-height",l)}if(typeof p!="undefined"){e.attr("data-gs-id",p)}this.container.append(e);this._prepareElement(e,true);this._triggerAddEvent();this._updateContainerHeight();this._triggerChangeEvent(true);return e};h.prototype.makeWidget=function(e){e=t(e);this._prepareElement(e,true);this._triggerAddEvent();this._updateContainerHeight();this._triggerChangeEvent(true);return e};h.prototype.willItFit=function(t,e,i,a,o){var r={x:t,y:e,width:i,height:a,autoPosition:o};return this.grid.canBePlacedWithRespectToHeight(r)};h.prototype.removeWidget=function(e,i){i=typeof i==="undefined"?true:i;e=t(e);var a=e.data("_gridstack_node");if(!a){a=this.grid.getNodeDataByDOMEl(e)}this.grid.removeNode(a,i);e.removeData("_gridstack_node");this._updateContainerHeight();if(i){e.remove()}this._triggerChangeEvent(true);this._triggerRemoveEvent()};h.prototype.removeAll=function(t){e.each(this.grid.nodes,e.bind(function(e){this.removeWidget(e.el,t)},this));this.grid.nodes=[];this._updateContainerHeight()};h.prototype.destroy=function(e){t(window).off("resize",this.onResizeHandler);this.disable();if(typeof e!="undefined"&&!e){this.removeAll(false);this.container.removeData("gridstack")}else{this.container.remove()}r.removeStylesheet(this._stylesId);if(this.grid){this.grid=null}};h.prototype.resizable=function(e,i){var a=this;e=t(e);e.each(function(e,o){o=t(o);var r=o.data("_gridstack_node");if(typeof r=="undefined"||r===null||typeof t.ui==="undefined"){return}r.noResize=!(i||false);if(r.noResize||a._isOneColumnMode()){a.dd.resizable(o,"disable")}else{a.dd.resizable(o,"enable")}});return this};h.prototype.movable=function(e,i){var a=this;e=t(e);e.each(function(e,o){o=t(o);var r=o.data("_gridstack_node");if(typeof r=="undefined"||r===null||typeof t.ui==="undefined"){return}r.noMove=!(i||false);if(r.noMove||a._isOneColumnMode()){a.dd.draggable(o,"disable");o.removeClass("ui-draggable-handle")}else{a.dd.draggable(o,"enable");o.addClass("ui-draggable-handle")}});return this};h.prototype.enableMove=function(t,e){this.movable(this.container.children("."+this.opts.itemClass),t);if(e){this.opts.disableDrag=!t}};h.prototype.enableResize=function(t,e){this.resizable(this.container.children("."+this.opts.itemClass),t);if(e){this.opts.disableResize=!t}};h.prototype.disable=function(){this.movable(this.container.children("."+this.opts.itemClass),false);this.resizable(this.container.children("."+this.opts.itemClass),false);this.container.trigger("disable")};h.prototype.enable=function(){this.movable(this.container.children("."+this.opts.itemClass),true);this.resizable(this.container.children("."+this.opts.itemClass),true);this.container.trigger("enable")};h.prototype.locked=function(e,i){e=t(e);e.each(function(e,a){a=t(a);var o=a.data("_gridstack_node");if(typeof o=="undefined"||o===null){return}o.locked=i||false;a.attr("data-gs-locked",o.locked?"yes":null)});return this};h.prototype.maxHeight=function(e,i){e=t(e);e.each(function(e,a){a=t(a);var o=a.data("_gridstack_node");if(typeof o==="undefined"||o===null){return}if(!isNaN(i)){o.maxHeight=i||false;a.attr("data-gs-max-height",i)}});return this};h.prototype.minHeight=function(e,i){e=t(e);e.each(function(e,a){a=t(a);var o=a.data("_gridstack_node");if(typeof o==="undefined"||o===null){return}if(!isNaN(i)){o.minHeight=i||false;a.attr("data-gs-min-height",i)}});return this};h.prototype.maxWidth=function(e,i){e=t(e);e.each(function(e,a){a=t(a);var o=a.data("_gridstack_node");if(typeof o==="undefined"||o===null){return}if(!isNaN(i)){o.maxWidth=i||false;a.attr("data-gs-max-width",i)}});return this};h.prototype.minWidth=function(e,i){e=t(e);e.each(function(e,a){a=t(a);var o=a.data("_gridstack_node");if(typeof o==="undefined"||o===null){return}if(!isNaN(i)){o.minWidth=i||false;a.attr("data-gs-min-width",i)}});return this};h.prototype._updateElement=function(e,i){e=t(e).first();var a=e.data("_gridstack_node");if(typeof a=="undefined"||a===null){return}var o=this;o.grid.cleanNodes();o.grid.beginUpdate(a);i.call(this,e,a);o._updateContainerHeight();o._triggerChangeEvent();o.grid.endUpdate()};h.prototype.resize=function(t,e,i){this._updateElement(t,function(t,a){e=e!==null&&typeof e!="undefined"?e:a.width;i=i!==null&&typeof i!="undefined"?i:a.height;this.grid.moveNode(a,a.x,a.y,e,i)})};h.prototype.move=function(t,e,i){this._updateElement(t,function(t,a){e=e!==null&&typeof e!="undefined"?e:a.x;i=i!==null&&typeof i!="undefined"?i:a.y;this.grid.moveNode(a,e,i,a.width,a.height)})};h.prototype.update=function(t,e,i,a,o){this._updateElement(t,function(t,r){e=e!==null&&typeof e!="undefined"?e:r.x;i=i!==null&&typeof i!="undefined"?i:r.y;a=a!==null&&typeof a!="undefined"?a:r.width;o=o!==null&&typeof o!="undefined"?o:r.height;this.grid.moveNode(r,e,i,a,o)})};h.prototype.verticalMargin=function(t,e){if(typeof t=="undefined"){return this.opts.verticalMargin}var i=r.parseHeight(t);if(this.opts.verticalMarginUnit===i.unit&&this.opts.height===i.height){return}this.opts.verticalMarginUnit=i.unit;this.opts.verticalMargin=i.height;if(!e){this._updateStyles()}};h.prototype.cellHeight=function(t,e){if(typeof t=="undefined"){if(this.opts.cellHeight){return this.opts.cellHeight}var i=this.container.children("."+this.opts.itemClass).first();return Math.ceil(i.outerHeight()/i.attr("data-gs-height"))}var a=r.parseHeight(t);if(this.opts.cellHeightUnit===a.heightUnit&&this.opts.height===a.height){return}this.opts.cellHeightUnit=a.unit;this.opts.cellHeight=a.height;if(!e){this._updateStyles()}};h.prototype.cellWidth=function(){return Math.round(this.container.outerWidth()/this.opts.width)};h.prototype.getCellFromPixel=function(t,e){var i=typeof e!="undefined"&&e?this.container.offset():this.container.position();var a=t.left-i.left;var o=t.top-i.top;var r=Math.floor(this.container.width()/this.opts.width);var n=Math.floor(this.container.height()/parseInt(this.container.attr("data-gs-current-height")));return{x:Math.floor(a/r),y:Math.floor(o/n)}};h.prototype.batchUpdate=function(){this.grid.batchUpdate()};h.prototype.commit=function(){this.grid.commit();this._updateContainerHeight()};h.prototype.isAreaEmpty=function(t,e,i,a){return this.grid.isAreaEmpty(t,e,i,a)};h.prototype.setStatic=function(t){this.opts.staticGrid=t===true;this.enableMove(!t);this.enableResize(!t);this._setStaticClass()};h.prototype._setStaticClass=function(){var t="grid-stack-static";if(this.opts.staticGrid===true){this.container.addClass(t)}else{this.container.removeClass(t)}};h.prototype._updateNodeWidths=function(t,e){this.grid._sortNodes();this.grid.batchUpdate();var i={};for(var a=0;a<this.grid.nodes.length;a++){i=this.grid.nodes[a];this.update(i.el,Math.round(i.x*e/t),undefined,Math.round(i.width*e/t),undefined)}this.grid.commit()};h.prototype.setGridWidth=function(t,e){this.container.removeClass("grid-stack-"+this.opts.width);if(e!==true){this._updateNodeWidths(this.opts.width,t)}this.opts.width=t;this.grid.width=t;this.container.addClass("grid-stack-"+t)};d.prototype.batch_update=a(d.prototype.batchUpdate);d.prototype._fix_collisions=a(d.prototype._fixCollisions,"_fix_collisions","_fixCollisions");d.prototype.is_area_empty=a(d.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty");d.prototype._sort_nodes=a(d.prototype._sortNodes,"_sort_nodes","_sortNodes");d.prototype._pack_nodes=a(d.prototype._packNodes,"_pack_nodes","_packNodes");d.prototype._prepare_node=a(d.prototype._prepareNode,"_prepare_node","_prepareNode");d.prototype.clean_nodes=a(d.prototype.cleanNodes,"clean_nodes","cleanNodes");d.prototype.get_dirty_nodes=a(d.prototype.getDirtyNodes,"get_dirty_nodes","getDirtyNodes");d.prototype.add_node=a(d.prototype.addNode,"add_node","addNode, ");d.prototype.remove_node=a(d.prototype.removeNode,"remove_node","removeNode");d.prototype.can_move_node=a(d.prototype.canMoveNode,"can_move_node","canMoveNode");d.prototype.move_node=a(d.prototype.moveNode,"move_node","moveNode");d.prototype.get_grid_height=a(d.prototype.getGridHeight,"get_grid_height","getGridHeight");d.prototype.begin_update=a(d.prototype.beginUpdate,"begin_update","beginUpdate");d.prototype.end_update=a(d.prototype.endUpdate,"end_update","endUpdate");d.prototype.can_be_placed_with_respect_to_height=a(d.prototype.canBePlacedWithRespectToHeight,"can_be_placed_with_respect_to_height","canBePlacedWithRespectToHeight");h.prototype._trigger_change_event=a(h.prototype._triggerChangeEvent,"_trigger_change_event","_triggerChangeEvent");h.prototype._init_styles=a(h.prototype._initStyles,"_init_styles","_initStyles");h.prototype._update_styles=a(h.prototype._updateStyles,"_update_styles","_updateStyles");h.prototype._update_container_height=a(h.prototype._updateContainerHeight,"_update_container_height","_updateContainerHeight");h.prototype._is_one_column_mode=a(h.prototype._isOneColumnMode,"_is_one_column_mode","_isOneColumnMode");h.prototype._prepare_element=a(h.prototype._prepareElement,"_prepare_element","_prepareElement");h.prototype.set_animation=a(h.prototype.setAnimation,"set_animation","setAnimation");h.prototype.add_widget=a(h.prototype.addWidget,"add_widget","addWidget");h.prototype.make_widget=a(h.prototype.makeWidget,"make_widget","makeWidget");h.prototype.will_it_fit=a(h.prototype.willItFit,"will_it_fit","willItFit");h.prototype.remove_widget=a(h.prototype.removeWidget,"remove_widget","removeWidget");h.prototype.remove_all=a(h.prototype.removeAll,"remove_all","removeAll");h.prototype.min_height=a(h.prototype.minHeight,"min_height","minHeight");h.prototype.min_width=a(h.prototype.minWidth,"min_width","minWidth");h.prototype._update_element=a(h.prototype._updateElement,"_update_element","_updateElement");h.prototype.cell_height=a(h.prototype.cellHeight,"cell_height","cellHeight");h.prototype.cell_width=a(h.prototype.cellWidth,"cell_width","cellWidth");h.prototype.get_cell_from_pixel=a(h.prototype.getCellFromPixel,"get_cell_from_pixel","getCellFromPixel");h.prototype.batch_update=a(h.prototype.batchUpdate,"batch_update","batchUpdate");h.prototype.is_area_empty=a(h.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty");h.prototype.set_static=a(h.prototype.setStatic,"set_static","setStatic");h.prototype._set_static_class=a(h.prototype._setStaticClass,"_set_static_class","_setStaticClass");i.GridStackUI=h;i.GridStackUI.Utils=r;i.GridStackUI.Engine=d;i.GridStackUI.GridStackDragDropPlugin=n;t.fn.gridstack=function(e){return this.each(function(){var i=t(this);if(!i.data("gridstack")){i.data("gridstack",new h(this,e))}})};return i.GridStackUI});