sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","inhance/userManagementSecurity/util/formatter"],function(e,t,a){"use strict";return e.extend("inhance.userManagementSecurity.controller.adminDetail",{formatter:a,onInit:function(){var e=this;if(!this.valueHelpForOrganization)this.valueHelpForOrganization=new sap.ui.xmlfragment("inhance.userManagementSecurity.fragments.valueHelpForOrganization",this);if(!this.valueHelpForApplicationList)this.valueHelpForApplicationList=new sap.ui.xmlfragment("inhance.userManagementSecurity.fragments.valueHelpForApplicationList",this);this.getView().addDependent(this.valueHelpForApplicationList);sap.ui.core.UIComponent.getRouterFor(this).getRoute("adminDetail").attachPatternMatched(function(t){e._objPatternMatched(t.getParameter("arguments").userId,t.getParameter("arguments").path)},this)},_objPatternMatched:function(e,t){var a=this;this.handleClearUserTableFilters();this.getView().setBusy(true);this.oranizationId=e;this.oranizationItemIndex=t;var i=new sap.ui.model.json.JSONModel("/BrevoMongoDB/UM/getorganisationdetailhierarchy?param1="+this.oranizationId);i.attachRequestCompleted(function(){a.getView().setModel(i);a.getView().setBusy(false);window.setTimeout(function(){a.getView().byId("LicenseTypeId").setSelectedKey(i.oData[0].License[0].license_type)},500)});this.getView().getModel("appView").setProperty("/sideMenuVisible",true)},handleSaveOrganization:function(){var e=this;t.confirm("Are you Sure want to save your changes",function(a){if(a=="OK"){e.handleSaveCancelButton(false);t.information("Changes are saved Successfully")}})},handleCancelOrganization:function(){var e=this;t.confirm("Are you sure want to cancel your changes",{onClose:function(t){if(t=="OK"){e.handleSaveCancelButton(false)}}})},handleDeleteOrganizationPress:function(){var e=this;this.getView().setBusy(true);t.confirm("Are you sure want to delete a Organization?",{onClose:function(a){if(a=="OK"){$.post("/BrevoMongoDB/UM/deleteteorganisation?param1="+e.oranizationId,{id:parseInt(e.oranizationId)},function(a){if(a=="success"){e.getView().setBusy(false);e.getOwnerComponent().getModel("organization").oData.splice(e.oranizationItemIndex,1);e.getOwnerComponent().getModel("organization").updateBindings(true);t.success(a);e.getView().getModel("appView").setProperty("/layout","OneColumn")}})}else e.getView().setBusy(false)}})},handleEditOrganizationPress:function(){var e=this.getView().getModel().oData;var t={id:e[0]._id,name:e[0].name,description:e[0].description,phone:e[0].phone,org_email:e[0].org_email,address:e[0].address,createdate:e[0].createdate,modifydate:(new Date).toJSON(),license_type:e[0].License[0].license_type,startdate:e[0].License[0].startdate,enddate:e[0].License[0].enddate,dashboardcountallowed:e[0].License[0].dashboardcountallowed,usercountallowed:e[0].License[0].usercountallowed,firstname:e[0].user[0].firstname,lastname:e[0].user[0].lastname,user_emailid:e[0].user[0].user_emailid,userid:"12345",contactnumber:e[0].user[0].contactnumber,application:e[0].applications};this.valueHelpForOrganization.setModel(new sap.ui.model.json.JSONModel(t));this.valueHelpForOrganization.open()},handleOrganizationCancel:function(){this.valueHelpForOrganization.close()},handleOrganizationSave:function(){var e=this;var a=[];this.valueHelpForOrganization.getModel().getData().application.forEach(function(e){a.push({createdate:e.createdate,description:e.application_desc!=undefined?e.application_desc:e.description,id:e.applicationid!=undefined?e.applicationid:e._id,link:e.application_link!=undefined?e.application_link:e.link,modifydate:e.modifydate,name:e.name})});this.valueHelpForOrganization.getModel().getData()["startdate"]=new Date(this.valueHelpForOrganization.getContent()[0].getContent()[16].getValue().split(" - ")[0]).toJSON();this.valueHelpForOrganization.getModel().getData()["enddate"]=new Date(this.valueHelpForOrganization.getContent()[0].getContent()[16].getValue().split(" - ")[1]).toJSON();this.valueHelpForOrganization.getModel().getData()["application"]=a;this.getView().setBusy(true);var i="12345";var n=this.getView().getModel().oData[0].License[0]._id;var o=this.getView().getModel().oData[0].user[0]._id;this.valueHelpForOrganization.getModel().getData()["applicationIds"]=[];for(var s=0;s<a.length;s++){this.valueHelpForOrganization.getModel().getData()["applicationIds"].push(a[s].id)}$.post("/BrevoMongoDB/UM/editorganisationnew?param1="+i+"&param2="+e.oranizationId+"&param3="+n+"&param4="+o,this.valueHelpForOrganization.getModel().getData(),function(a){e.getView().setBusy(false);if(a=="ok"){t.success("Organization Updated Successfully");e._objPatternMatched(e.oranizationId,e.oranizationItemIndex)}else{t.error(a)}});this.valueHelpForOrganization.close()},handleDateRange:function(e){var t=e.getSource().getDateValue();var a=e.getSource().getSecondDateValue();var i=Math.abs(a.getTime()-t.getTime());var n=Math.ceil(i/(1e3*60*60*24));this.valueHelpForOrganization.getContent()[0].getContent()[18].setValue(n)},handleUpdateTableItems:function(e){if(this.getView().byId("usersTableId").getBinding("items").aFilters.length>0){this.getView().byId("clearFilterId").setVisible(true)}else{this.getView().byId("clearFilterId").setVisible(false)}},handleClearUserTableFilters:function(){this.getView().byId("usersTableId").getBinding("items").filter([])},handleUsersTableItems:function(e){this.getView().byId("usersTableId").getBinding("items").filter([new sap.ui.model.Filter("roleid","Contains",e.getSource().getBindingContext().getObject()._id)])},onCloseDetailPress:function(){var e=this.getView().getModel("appView").getProperty("/actionButtonsInfo/midColumn/closeColumn");this.getView().getModel("appView").setProperty("/actionButtonsInfo/midColumn/closeColumn",!e);this.getView().getModel("appView").setProperty("/layout","OneColumn");var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("adminMaster")},handleApplicationValueHelp:function(){this.handleListItemsSelected();this.valueHelpForApplicationList.open()},handleListItemsSelected:function(){for(var e=0;e<this.valueHelpForOrganization.getModel().getData().application.length;e++){for(var t=0;t<this.valueHelpForApplicationList.getItems().length;t++){if(this.valueHelpForOrganization.getModel().getData().application[e].name==this.valueHelpForApplicationList.getItems()[t].getBindingContext("applications").getObject().name){this.valueHelpForApplicationList.getItems()[t].setSelected(true);break}}}},handleConfirmAppList:function(e){var t=this;this.appObject=[];e.getParameter("selectedItems").forEach(function(e){t.appObject.push(e.getBindingContext("applications").getObject())});this.valueHelpForOrganization.getModel().getData()["application"]=this.appObject;this.valueHelpForOrganization.getModel().updateBindings(true)},handleInputTokenDeleted:function(e){var t=e.getParameter("removedTokens")[0].getBindingContext().sPath.split("/")[2];e.getParameter("removedTokens")[0].getBindingContext().getModel().getData().application.splice(t,1)},handleCloseAppList:function(){}})});