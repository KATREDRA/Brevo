sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","inhance/userManagementSecurity/util/formatter"],function(e,t,a){"use strict";return e.extend("inhance.userManagementSecurity.controller.adminMaster",{formatter:a,onInit:function(){this.appObject=[];if(!this.valueHelpForOrganization)this.valueHelpForOrganization=new sap.ui.xmlfragment("inhance.userManagementSecurity.fragments.valueHelpForOrganization",this);if(!this.valueHelpForApplicationList)this.valueHelpForApplicationList=new sap.ui.xmlfragment("inhance.userManagementSecurity.fragments.valueHelpForApplicationList",this);this.getView().addDependent(this.valueHelpForApplicationList);sap.ui.core.UIComponent.getRouterFor(this).getRoute("adminMaster").attachPatternMatched(this._objPatternMatched,this)},onAfterRendering:function(){this.handleOrganizationModel()},handleOrganizationModel:function(){var e=this;this.getView().byId("organizationList").setBusy(true);var t=new sap.ui.model.json.JSONModel("/BrevoMongoDB/UM/getorganisations");t.attachRequestCompleted(function(){e.getView().byId("organizationList").setBusy(false);e.getOwnerComponent().setModel(t,"organization")})},_objPatternMatched:function(){this.getView().getModel("appView").setProperty("/sideMenuVisible",true);this.handleOrganizationModel()},onSearch:function(e){this.getView().byId("organizationList").getBinding("items").filter([new sap.ui.model.Filter("name","Contains",e.getParameter("newValue"))])},handleOrganizationsListPress:function(e){this.getView().getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("adminDetail",{userId:e.getParameter("listItem").getBindingContext("organization").getObject()._id,path:e.getParameter("listItem").getBindingContextPath("organization").split("/")[1]})},handleAddNewOrganization:function(){
/*var organizationObj = {
				"organizationName": "",
				"organizationId": 500 + this.getOwnerComponent().getModel().getData().superAdmin.length + 1,
				"organizationDescription": "",
				"Email": "",
				"Phone": "",
				"Address": "",
				"admin": [{
					"adminName": "",
					"FirstName": "",
					"LastName": "",
					"Email": "",
					"Contact No.": ""

				}],
				"roles": [{
					"roleName": "Administrator",
					"noOfUsers": "1",
					"createdAt": this.todayDate(),
					"lastChangedAt": this.todayDate()
				}],

				"LicenseType": "",
				"LicensePeriod": "",
				"LicenseSpan": "",
				"Authorize_to_Create_No_Of_Dashboards": "",
				"Authorize_to_Create_No_Of_Users": "",
				"apps": []
			};*/
var e={name:"",description:"",phone:"",org_email:"",address:"",createdate:(new Date).toJSON(),modifydate:(new Date).toJSON(),license_type:"",startdate:"",enddate:"",dashboardcountallowed:"",usercountallowed:"",firstname:"",lastname:"",user_emailid:"",contactnumber:"",application:[]};this.valueHelpForOrganization.setModel(new sap.ui.model.json.JSONModel(e));this.valueHelpForOrganization.open()},todayDate:function(){var e=sap.ui.core.format.DateFormat.getDateInstance({pattern:"MM/dd/YYYY"});return e.format(new Date)},handleOrganizationCancel:function(){this.valueHelpForOrganization.close()},handleOrganizationSave:function(){var e=this;if(this.handleValidationsForOrganization()!=0||this.handleValidationsForOrganization()==true){var a=this.valueHelpForOrganization.getModel().getData();a.applicationIds=[];a.application.forEach(function(e){a.applicationIds.push(e._id)});delete a.applications;e.getView().setBusy(true);a["startdate"]=new Date(this.valueHelpForOrganization.getContent()[0].getContent()[16].getValue().split(" - ")[0]).toJSON();a["enddate"]=new Date(this.valueHelpForOrganization.getContent()[0].getContent()[16].getValue().split(" - ")[1]).toJSON();$.post("/BrevoMongoDB/UM/createorganisation",a,function(a){if(a=="okk"){t.success("Organization Created Successfully");var n=new sap.ui.model.json.JSONModel("/BrevoMongoDB/UM/getorganisations");n.attachRequestCompleted(function(){e.getView().setBusy(false);e.getOwnerComponent().setModel(n,"organization")});e.valueHelpForOrganization.close()}else{t.error(a)}})}else{if(this.handleValidationsForOrganization()==0){sap.m.MessageBox.error("Please enter Valid Mail")}else{sap.m.MessageBox.error("Please fill the mandatory fields!")}}},handleValidationsForOrganization:function(){var e=[2,4,16,18,20,22,25,27,29],t=true;for(var a=0;a<e.length;a++){if(this.valueHelpForOrganization.getContent()[0].getContent()[e[a]].getValue().length==0){t=false;break}}var n=/^[a-zA-Z][\w\.-]*[a-zA-Z0-9]@[a-zA-Z0-9][\w\.-]*[a-zA-Z0-9]\.[a-zA-Z][a-zA-Z\.]*[a-zA-Z]$/;if(!n.test(this.valueHelpForOrganization.getContent()[0].getContent()[9].getValue())||!n.test(this.valueHelpForOrganization.getContent()[0].getContent()[29].getValue())){t=0}if(this.valueHelpForOrganization.getContent()[0].getContent()[14].getSelectedKey().length==0)t=false;return t},handleDateRange:function(e){var t=e.getSource().getDateValue();var a=e.getSource().getSecondDateValue();var n=Math.abs(a.getTime()-t.getTime());var i=Math.ceil(n/(1e3*60*60*24));this.valueHelpForOrganization.getContent()[0].getContent()[18].setValue(i);this.valueHelpForOrganization.getModel().oData.startdate=this.valueHelpForOrganization.getContent()[0].getContent()[16].getValue().split(" - ")[0];this.valueHelpForOrganization.getModel().oData.enddate=this.valueHelpForOrganization.getContent()[0].getContent()[16].getValue().split(" - ")[1]},onNavBack:function(){this.getView().getModel("appView").setProperty("/layout","OneColumn");sap.ui.core.UIComponent.getRouterFor(this).navTo("Home")},handleApplicationValueHelp:function(){this.handleListItemsSelected();this.valueHelpForApplicationList.open()},handleListItemsSelected:function(){for(var e=0;e<this.valueHelpForOrganization.getModel().getData().application.length;e++){for(var t=0;t<this.valueHelpForApplicationList.getItems().length;t++){if(this.valueHelpForOrganization.getModel().getData().application[e].id==this.valueHelpForApplicationList.getItems()[t].getBindingContext("applications").getObject().id){this.valueHelpForApplicationList.getItems()[t].setSelected(true);break}}}},handleConfirmAppList:function(e){var t=this;this.appObject=[];e.getParameter("selectedItems").forEach(function(e){t.appObject.push(e.getBindingContext("applications").getObject())});this.valueHelpForOrganization.getModel().getData()["application"]=this.appObject;this.valueHelpForOrganization.getModel().updateBindings(true)},handleInputTokenDeleted:function(e){var t=e.getParameter("removedTokens")[0].getBindingContext().sPath.split("/")[2];e.getParameter("removedTokens")[0].getBindingContext().getModel().oData.application.splice(t,1)},handleCloseAppList:function(){},limitPhoneNumbers:function(e){var t=this;var a=e.getParameter("value");var n="";if(a.length<=12){for(var i=0;i<a.length;i++){n=n+a[i];e.getSource().setValue(n);var o=e.getSource();var r=o.getValue();r=r.replace(/[^\d]/g,"");o.setValue(r)}this.numVal=n}else{sap.m.MessageToast.show("Please Enter 12 Digits only");t.valueHelpForOrganization.getContent()[0].getContent()[7].setValue(t.numVal)}},limitPhoneNumbersadmin:function(e){var t=this;var a=e.getParameter("value");var n="";if(a.length<=12){for(var i=0;i<a.length;i++){n=n+a[i];e.getSource().setValue(n);var o=e.getSource();var r=o.getValue();r=r.replace(/[^\d]/g,"");o.setValue(r)}this.numValadmin=n}else{sap.m.MessageToast.show("Please Enter 12 Digits only");t.valueHelpForOrganization.getContent()[0].getContent()[31].setValue(t.numValadmin)}}})});