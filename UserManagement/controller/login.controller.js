var that;var email=document.querySelector("#email"),password=document.querySelector("#password"),mySVG=document.querySelector(".svgContainer"),armL=document.querySelector(".armL"),armR=document.querySelector(".armR"),eyeL=document.querySelector(".eyeL"),eyeR=document.querySelector(".eyeR"),nose=document.querySelector(".nose"),mouth=document.querySelector(".mouth"),mouthBG=document.querySelector(".mouthBG"),mouthSmallBG=document.querySelector(".mouthSmallBG"),mouthMediumBG=document.querySelector(".mouthMediumBG"),mouthLargeBG=document.querySelector(".mouthLargeBG"),mouthMaskPath=document.querySelector("#mouthMaskPath"),mouthOutline=document.querySelector(".mouthOutline"),tooth=document.querySelector(".tooth"),tongue=document.querySelector(".tongue"),chin=document.querySelector(".chin"),face=document.querySelector(".face"),eyebrow=document.querySelector(".eyebrow"),outerEarL=document.querySelector(".earL .outerEar"),outerEarR=document.querySelector(".earR .outerEar"),earHairL=document.querySelector(".earL .earHair"),earHairR=document.querySelector(".earR .earHair"),hair=document.querySelector(".hair");var caretPos,curEmailIndex,screenCenter,svgCoords,eyeMaxHorizD=20,eyeMaxVertD=10,noseMaxHorizD=23,noseMaxVertD=10,dFromC,eyeDistH,eyeLDistV,eyeRDistV,eyeDistR,mouthStatus="small";sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","inhance/userManagementSecurity/js/avatar"],function(e,t,o){"use strict";return e.extend("inhance.userManagementSecurity.controller.login",{onInit:function(){that=this;sap.ui.core.UIComponent.getRouterFor(this).getRoute("login").attachPatternMatched(this._objPatternMatched,this)},_objPatternMatched:function(){this.getView().getModel("appView").setProperty("/sideMenuVisible",false);this.destination=this.getView().getModel("appView").getProperty("/destination");$(document).ready(function(){window.history.pushState(null,"",window.location.href);window.onpopstate=function(){window.history.pushState(null,"",window.location.href)}})},onAfterRendering:function(){email=document.querySelector("#email");password=document.querySelector("#password");mySVG=document.querySelector(".svgContainer");armL=document.querySelector(".armL");armR=document.querySelector(".armR");eyeL=document.querySelector(".eyeL");eyeR=document.querySelector(".eyeR");nose=document.querySelector(".nose");mouth=document.querySelector(".mouth");mouthBG=document.querySelector(".mouthBG");mouthSmallBG=document.querySelector(".mouthSmallBG");mouthMediumBG=document.querySelector(".mouthMediumBG");mouthLargeBG=document.querySelector(".mouthLargeBG");mouthMaskPath=document.querySelector("#mouthMaskPath");mouthOutline=document.querySelector(".mouthOutline");tooth=document.querySelector(".tooth");tongue=document.querySelector(".tongue");chin=document.querySelector(".chin");face=document.querySelector(".face");eyebrow=document.querySelector(".eyebrow");outerEarL=document.querySelector(".earL .outerEar");outerEarR=document.querySelector(".earR .outerEar");earHairL=document.querySelector(".earL .earHair");earHairR=document.querySelector(".earR .earHair");hair=document.querySelector(".hair");email.addEventListener("focus",this.onEmailFocus);email.addEventListener("focus",this.onEmailFocus);email.addEventListener("blur",this.onEmailBlur);email.addEventListener("input",this.onEmailInput);password.addEventListener("focus",this.onPasswordFocus);password.addEventListener("blur",this.onPasswordBlur);TweenMax.set(armL,{x:-93,y:220,rotation:105,transformOrigin:"top left"});TweenMax.set(armR,{x:-93,y:220,rotation:-105,transformOrigin:"top right"});document.querySelector("#login").addEventListener("click",this.handleLoginButtonPress)},onEmailFocus:function(e){e.target.parentElement.classList.add("focusWithText");that.getCoord(e)},onEmailInput:function(e){that.getCoord(e);var t=e.target.value;curEmailIndex=t.length;if(curEmailIndex>0){if(mouthStatus=="small"){mouthStatus="medium";TweenMax.to([mouthBG,mouthOutline,mouthMaskPath],1,{morphSVG:mouthMediumBG,shapeIndex:8,ease:Expo.easeOut});TweenMax.to(tooth,1,{x:0,y:0,ease:Expo.easeOut});TweenMax.to(tongue,1,{x:0,y:1,ease:Expo.easeOut});TweenMax.to([eyeL,eyeR],1,{scaleX:.85,scaleY:.85,ease:Expo.easeOut})}if(t.includes("@")){mouthStatus="large";TweenMax.to([mouthBG,mouthOutline,mouthMaskPath],1,{morphSVG:mouthLargeBG,ease:Expo.easeOut});TweenMax.to(tooth,1,{x:3,y:-2,ease:Expo.easeOut});TweenMax.to(tongue,1,{y:2,ease:Expo.easeOut});TweenMax.to([eyeL,eyeR],1,{scaleX:.65,scaleY:.65,ease:Expo.easeOut,transformOrigin:"center center"})}else{mouthStatus="medium";TweenMax.to([mouthBG,mouthOutline,mouthMaskPath],1,{morphSVG:mouthMediumBG,ease:Expo.easeOut});TweenMax.to(tooth,1,{x:0,y:0,ease:Expo.easeOut});TweenMax.to(tongue,1,{x:0,y:1,ease:Expo.easeOut});TweenMax.to([eyeL,eyeR],1,{scaleX:.85,scaleY:.85,ease:Expo.easeOut})}}else{mouthStatus="small";TweenMax.to([mouthBG,mouthOutline,mouthMaskPath],1,{morphSVG:mouthSmallBG,shapeIndex:9,ease:Expo.easeOut});TweenMax.to(tooth,1,{x:0,y:0,ease:Expo.easeOut});TweenMax.to(tongue,1,{y:0,ease:Expo.easeOut});TweenMax.to([eyeL,eyeR],1,{scaleX:1,scaleY:1,ease:Expo.easeOut})}},getCoord:function(e){var t,o,a,r,n=20,s=10,u=23,i=10,c,l,m,d,y,h="small";var x=email.selectionEnd,p=document.createElement("div"),g=document.createElement("span"),w=getComputedStyle(email),M={},E={},S={};[].forEach.call(w,function(e){p.style[e]=w[e]});p.style.position="absolute";document.body.appendChild(p);p.textContent=email.value.substr(0,x);g.textContent=email.value.substr(x)||".";p.appendChild(g);M=getPosition(email);E=getPosition(g);S=getPosition(mySVG);r=getPosition(mySVG);a=S.x+mySVG.offsetWidth/2;t=E.x+M.x;c=a-t;var f=Math.round(t/a*100)/100;if(f<1){}else if(f>1){f-=2;f=Math.abs(f)}l=-c*.05;if(l>n){l=n}else if(l<-n){l=-n}var v={x:r.x+84,y:r.y+76};var O={x:r.x+113,y:r.y+76};var L={x:r.x+97,y:r.y+81};var T={x:r.x+100,y:r.y+100};var q=getAngle(v.x,v.y,M.x+E.x,M.y+25);var B=Math.cos(q)*n;var R=Math.sin(q)*s;var P=getAngle(O.x,O.y,M.x+E.x,M.y+25);var G=Math.cos(P)*n;var V=Math.sin(P)*s;var C=getAngle(L.x,L.y,M.x+E.x,M.y+25);var b=Math.cos(C)*u;var I=Math.sin(C)*i;var H=getAngle(T.x,T.y,M.x+E.x,M.y+25);var D=Math.cos(H)*u;var k=Math.sin(H)*i;var F=Math.cos(H)*6;var Y=D*.8;var A=k*.5;var X=1-c*.15/100;if(X>1){X=1-(X-1)}var N=D*.3;var Q=k*.4;var J=Math.cos(H)*5;var U=Math.cos(H)*25;var j=Math.cos(H)*4;var z=Math.cos(H)*5;var W=Math.cos(H)*6;var $=1.2;TweenMax.to(eyeL,1,{x:-B,y:-R,ease:Expo.easeOut});TweenMax.to(eyeR,1,{x:-G,y:-V,ease:Expo.easeOut});TweenMax.to(nose,1,{x:-b,y:-I,rotation:F,transformOrigin:"center center",ease:Expo.easeOut});TweenMax.to(mouth,1,{x:-D,y:-k,rotation:F,transformOrigin:"center center",ease:Expo.easeOut});TweenMax.to(chin,1,{x:-Y,y:-A,scaleY:X,ease:Expo.easeOut});TweenMax.to(face,1,{x:-N,y:-Q,skewX:-J,transformOrigin:"center top",ease:Expo.easeOut});TweenMax.to(eyebrow,1,{x:-N,y:-Q,skewX:-U,transformOrigin:"center top",ease:Expo.easeOut});TweenMax.to(outerEarL,1,{x:j,y:-z,ease:Expo.easeOut});TweenMax.to(outerEarR,1,{x:j,y:z,ease:Expo.easeOut});TweenMax.to(earHairL,1,{x:-j,y:-z,ease:Expo.easeOut});TweenMax.to(earHairR,1,{x:-j,y:z,ease:Expo.easeOut});TweenMax.to(hair,1,{x:W,scaleY:$,transformOrigin:"center bottom",ease:Expo.easeOut});document.body.removeChild(p)},onEmailBlur:function(e){if(e.target.value==""){e.target.parentElement.classList.remove("focusWithText")}that.resetFace()},onPasswordFocus:function(e){that.coverEyes()},onPasswordBlur:function(e){that.uncoverEyes()},coverEyes:function(){TweenMax.to(armL,.45,{x:-93,y:2,rotation:0,ease:Quad.easeOut});TweenMax.to(armR,.45,{x:-93,y:2,rotation:0,ease:Quad.easeOut,delay:.1})},uncoverEyes:function(){TweenMax.to(armL,1.35,{y:220,ease:Quad.easeOut});TweenMax.to(armL,1.35,{rotation:105,ease:Quad.easeOut,delay:.1});TweenMax.to(armR,1.35,{y:220,ease:Quad.easeOut});TweenMax.to(armR,1.35,{rotation:-105,ease:Quad.easeOut,delay:.1})},resetFace:function(){TweenMax.to([eyeL,eyeR],1,{x:0,y:0,ease:Expo.easeOut});TweenMax.to(nose,1,{x:0,y:0,scaleX:1,scaleY:1,ease:Expo.easeOut});TweenMax.to(mouth,1,{x:0,y:0,rotation:0,ease:Expo.easeOut});TweenMax.to(chin,1,{x:0,y:0,scaleY:1,ease:Expo.easeOut});TweenMax.to([face,eyebrow],1,{x:0,y:0,skewX:0,ease:Expo.easeOut});TweenMax.to([outerEarL,outerEarR,earHairL,earHairR,hair],1,{x:0,y:0,scaleY:1,ease:Expo.easeOut})},getAngle:function(e,t,o,a){var r=Math.atan2(t-a,e-o);return r},getPosition:function(e){var t=0;var o=0;while(e){if(e.tagName=="BODY"){var a=e.scrollLeft||document.documentElement.scrollLeft;var r=e.scrollTop||document.documentElement.scrollTop;t+=e.offsetLeft-a+e.clientLeft;o+=e.offsetTop-r+e.clientTop}else{t+=e.offsetLeft-e.scrollLeft+e.clientLeft;o+=e.offsetTop-e.scrollTop+e.clientTop}e=e.offsetParent}return{x:t,y:o}},handleLoginButtonPress:function(e){var t=document.getElementById("email").value;var o=document.getElementById("password").value;if(t.length==0){sap.m.MessageToast.show("Please provide your Email!")}else if(!that.validateEmail(t)){sap.m.MessageToast.show("Invalid Email!")}else if(o.length==0){sap.m.MessageToast.show("Please provide your Password!")}else{that.getView().getModel("appView").setProperty("/loginUserName",t);that.getView().getModel("appView").setProperty("/loginUserPassword",o);that.handleLoginService(t,o);document.getElementById("email").value="";document.getElementById("password").value=""}},handleLoginService:function(e,o){var a=this;var r={user_email:e,password:o};$.post(this.destination+"/UM/loginuser",r,function(e){if(JSON.parse(e).Error!="Authentication Error"){sap.m.MessageToast.show("Logged in Successfully");var o=new sap.ui.model.json.JSONModel("/BrevoMongoDB/odata/mongodb/OVPPageConfig");o.attachRequestCompleted(function(){a.getOwnerComponent().setModel(o,"pages")});a.getView().getModel("appView").getData().loginDetails=JSON.parse(e);window.localStorage.setItem("loginDetails",JSON.stringify(JSON.parse(e)));var r=sap.ui.core.UIComponent.getRouterFor(a);r.navTo("Home")}else{t.error("Invalid Email ID or Password")}})},validateEmail:function(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(String(e).toLowerCase())}})});